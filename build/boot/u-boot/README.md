# U-Boot для Orange Pi PC

## Описание

Это руководство объясняет процесс сборки, настройки и прошивки U-Boot для платформы Orange Pi PC с процессором Allwinner H3. U-Boot является загрузчиком, который инициализирует оборудование и загружает операционную систему на устройстве. Этот проект включает конфигурации для SD карты, загрузки ядра и настройки сетевых интерфейсов.

## Требования

- Устройство Orange Pi PC с процессором Allwinner H3.
- Установленная утилита `make` для сборки U-Boot.
- Компилятор для ARM, например, `gcc-arm-linux-gnueabihf` для Linux.
- Карта памяти SD или флешка для загрузки U-Boot.

## Сборка U-Boot

1. **Клонируйте репозиторий с исходным кодом U-Boot**:
    ```bash
    git clone https://github.com/u-boot/u-boot.git
    cd u-boot
    ```

2. **Настройте конфигурацию для Orange Pi PC**:
    Убедитесь, что вы выбрали правильную конфигурацию для вашего устройства. Для Orange Pi PC используйте `sunxi_defconfig`:
    ```bash
    make sunxi_defconfig
    ```

3. **Сборка U-Boot**:
    После настройки конфигурации, скомпилируйте U-Boot для вашей платформы:
    ```bash
    make
    ```

4. **Запись U-Boot на SD карту**:
    После успешной сборки запишите бинарный файл загрузчика `u-boot.bin` на SD карту. Например, если ваша SD карта доступна как `/dev/sdX`, используйте команду:
    ```bash
    sudo dd if=u-boot.bin of=/dev/sdX bs=1024 seek=8
    ```

    Убедитесь, что указали правильный путь к устройству, чтобы избежать потери данных.

## Настройка загрузки

U-Boot можно настроить для загрузки ядра и файловой системы с различных устройств. Пример конфигурации для загрузки с SD карты:

1. **Создайте файл окружения (`u-boot.env`)**:
    В файле `u-boot.env` укажите параметры загрузки:
    ```bash
    bootargs=console=ttyS0,115200 root=/dev/mmcblk0p2 rootwait
    bootcmd=mmc dev 0; mmc read 0x40008000 0x800 0x1000; bootm 0x40008000
    ```

2. **Сохранение переменных окружения**:
    Запишите переменные окружения на SD карту:
    ```bash
    saveenv
    ```

## Загрузка через TFTP

Если вы хотите настроить загрузку через сеть с использованием TFTP, добавьте следующие параметры в `u-boot.env`:

```bash
bootcmd_tftp=dhcp; tftpboot 0x40008000 zImage; bootm 0x40008000
bootargs_tftp=console=ttyS0,115200 root=/dev/nfs nfsroot=192.168.1.100:/nfsroot rw ip=dhcp

Убедитесь, что на вашем TFTP сервере доступен файл ядра zImage и настроен NFS-сервер для монтирования файловой системы.

## Настройка сетевых интерфейсов

Для настройки Ethernet интерфейсов в u-boot.env можно задать IP-адреса и параметры сети:

```bash
ethaddr=00:14:22:01:02:03
ipaddr=192.168.1.2
serverip=192.168.1.100
netmask=255.255.255.0
gatewayip=192.168.1.1

## Прошивка U-Boot

Если необходимо прошить U-Boot в память устройства (например, в NAND), выполните следующие шаги:
1. Соберите U-Boot с настройками для NAND: Используйте конфигурацию для NAND устройства (если поддерживается):
```bash
make sunxi_nand_defconfig
make
2. Запишите прошитый образ в NAND: Следуйте инструкциям для прошивки на конкретной платформе (например, используя утилиту dfu-util или другие средства).

## Дополнительная информация

Для получения дополнительной информации, включая описание всех переменных окружения и команд U-Boot, посетите официальную документацию на U-Boot Wiki.

## Заключение

Теперь U-Boot готов к использованию на вашем устройстве Orange Pi PC. Вы можете настроить его для загрузки операционных систем с SD карты, TFTP сервера или других источников.
Благодаря гибкости конфигурации, U-Boot позволяет эффективно управлять загрузкой и настройкой системы на различных устройствах.
